<div class="modal fade" id="maintenanceModal" tabindex="-1" aria-labelledby="maintenanceModalLabel" aria-hidden="true" data-controller="maintenance-form">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content border-0 shadow">
      <div class="modal-header border-bottom-0">
        <div>
          <h1 class="modal-title fs-5" id="maintenanceModalLabel">メンテナンス記録</h1>
          <p class="mb-0 text-muted small">A4シート風のフォームで故障や点検の記録を統一して入力できます。</p>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="閉じる"></button>
      </div>
      <div class="modal-body bg-light">
        <div class="btn-group w-100 mb-3" role="group">
          <button type="button" class="btn btn-outline-secondary" data-maintenance-form-target="trigger" data-action="maintenance-form#select" data-type="fault">
            故障・事象
          </button>
          <button type="button" class="btn btn-outline-secondary" data-maintenance-form-target="trigger" data-action="maintenance-form#select" data-type="inspection">
            点検・車検
          </button>
        </div>
        <div class="bg-white border rounded-3 shadow-sm p-3">
          <div data-maintenance-form-target="panel" data-type="fault" class="maintenance-panel">
            <%= form_with model: @new_fault_log, url: vehicle_fault_logs_path(@vehicle), local: true, html: { multipart: true }, class: "d-flex flex-column gap-3" do |f| %>
              <div class="row g-3">
                <div class="col-md-8">
                  <label class="form-label small text-muted">タイトル / 故障箇所</label>
                  <%= f.text_field :title, class: "form-control form-control-sm", required: true %>
                </div>
                <div class="col-md-4">
                  <label class="form-label small text-muted">発生日</label>
                  <%= f.date_field :occurred_on, class: "form-control form-control-sm", required: true %>
                </div>
                <div class="col-md-4">
                  <label class="form-label small text-muted">解決日</label>
                  <%= f.date_field :resolved_on, class: "form-control form-control-sm" %>
                </div>
                <div class="col-md-4">
                  <label class="form-label small text-muted">重要度</label>
                  <%= f.select :severity, VehicleFaultLog.severities.keys.map { |key| [key.humanize, key] }, {}, class: "form-select form-select-sm" %>
                </div>
                <div class="col-md-4">
                  <label class="form-label small text-muted">対応状況</label>
                  <%= f.select :status, fault_status_options, {}, class: "form-select form-select-sm" %>
                </div>
                <div class="col-md-4">
                  <label class="form-label small text-muted">カテゴリ</label>
                  <%= f.text_field :category, class: "form-control form-control-sm", placeholder: "例: ブレーキ" %>
                </div>
                <div class="col-md-4">
                  <label class="form-label small text-muted">原因（一次判定）</label>
                  <%= f.text_field :cause_primary, class: "form-control form-control-sm" %>
                </div>
                <div class="col-md-4">
                  <label class="form-label small text-muted">概算見積</label>
                  <div class="input-group input-group-sm">
                    <span class="input-group-text">¥</span>
                    <%= f.number_field :estimated_cost, class: "form-control", step: 1000, min: 0 %>
                  </div>
                </div>
              </div>
              <div>
                <label class="form-label small text-muted">詳細メモ</label>
                <%= f.text_area :description, class: "form-control form-control-sm", rows: 4 %>
              </div>
              <div>
                <label class="form-label small text-muted">現場写真 (最大10枚)</label>
                <%= f.file_field :photos, multiple: true, accept: "image/*", class: "form-control form-control-sm" %>
              </div>
              <div class="text-end">
                <button type="button" class="btn btn-outline-secondary me-2" data-bs-dismiss="modal">キャンセル</button>
                <%= f.submit "記録を保存", class: "btn btn-primary" %>
              </div>
            <% end %>
          </div>
          <div data-maintenance-form-target="panel" data-type="inspection" class="maintenance-panel" hidden>
            <%= form_with model: @new_inspection_record, url: vehicle_inspection_records_path(@vehicle), local: true, class: "d-flex flex-column gap-3" do |f| %>
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label small text-muted">区分</label>
                  <%= f.select :inspection_type, ["車検", "定期点検", "12ヶ月点検", "特別検査", "その他"], {}, class: "form-select form-select-sm" %>
                </div>
                <div class="col-md-6">
                  <label class="form-label small text-muted">点検箇所</label>
                  <%= f.select :inspection_scope, inspection_scope_options, {}, class: "form-select form-select-sm" %>
                </div>
                <div class="col-md-4">
                  <label class="form-label small text-muted">予定日</label>
                  <%= f.date_field :scheduled_on, class: "form-control form-control-sm", required: true %>
                </div>
                <div class="col-md-4">
                  <label class="form-label small text-muted">実施日</label>
                  <%= f.date_field :completed_on, class: "form-control form-control-sm" %>
                </div>
                <div class="col-md-4">
                  <label class="form-label small text-muted">状態</label>
                  <%= f.select :status, VehicleInspectionRecord.statuses.keys.map { |key| [key.humanize, key] }, {}, class: "form-select form-select-sm" %>
                </div>
                <div class="col-md-6">
                  <label class="form-label small text-muted">担当者</label>
                  <%= f.text_field :inspector_name, class: "form-control form-control-sm" %>
                </div>
                <div class="col-md-6">
                  <label class="form-label small text-muted">依頼先</label>
                  <%= f.text_field :vendor_name, class: "form-control form-control-sm" %>
                </div>
                <div class="col-md-6">
                  <label class="form-label small text-muted">概算費用</label>
                  <div class="input-group input-group-sm">
                    <span class="input-group-text">¥</span>
                    <%= f.number_field :estimated_cost, class: "form-control", step: 1000, min: 0 %>
                  </div>
                </div>
              </div>
              <div>
                <label class="form-label small text-muted">メモ</label>
                <%= f.text_area :notes, class: "form-control form-control-sm", rows: 4 %>
              </div>
              <div class="text-end">
                <button type="button" class="btn btn-outline-secondary me-2" data-bs-dismiss="modal">キャンセル</button>
                <%= f.submit "点検を登録", class: "btn btn-primary" %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
