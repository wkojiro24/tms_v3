<% content_for :title, "管理ダッシュボード" %>
<% content_for :section_label, "管理者コンソール" %>

<div class="row g-4">
  <div class="col-lg-4">
    <div class="card card-lift shadow-sm h-100">
      <div class="card-body">
        <span class="badge-soft mb-3"><i class="bi bi-people-fill"></i> 登録ユーザー</span>
        <div class="stat-value text-primary"><%= User.count %> 名</div>
        <div class="text-muted small">管理者: <%= User.where(role: "admin").count %> / スタッフ: <%= User.where(role: "staff").count %></div>
      </div>
    </div>
  </div>
  <div class="col-lg-4">
    <div class="card card-lift shadow-sm h-100">
      <div class="card-body">
        <span class="badge-soft mb-3"><i class="bi bi-person-plus"></i> 今週の新規登録</span>
        <div class="stat-value text-success"><%= User.where("created_at >= ?", 7.days.ago).count %> 名</div>
        <p class="text-muted small mb-0">ロール割り当てと初期研修をフォローしてください。</p>
      </div>
    </div>
  </div>
  <div class="col-lg-4">
    <div class="card card-lift shadow-sm h-100">
      <div class="card-body">
        <span class="badge-soft mb-3"><i class="bi bi-shield-lock"></i> ロール設定</span>
        <div class="stat-value text-warning"><%= User.where(role: "admin").count %> 管理者</div>
        <p class="text-muted small mb-0">CanCanCanでアクセス制御を実施中です。</p>
      </div>
    </div>
  </div>
</div>

<div class="card card-lift shadow-sm mt-4">
  <div class="card-body">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h2 class="h5 mb-0">最新のユーザー</h2>
      <%= link_to "ユーザー管理へ", "#", class: "btn btn-sm btn-outline-secondary disabled", title: "今後の実装予定" %>
    </div>
    <div class="table-responsive">
      <table class="table align-middle mb-0">
        <thead class="table-light small">
          <tr>
            <th>氏名 / メール</th>
            <th>ロール</th>
            <th>登録日時</th>
          </tr>
        </thead>
        <tbody class="small">
          <% @recent_users.each do |user| %>
            <tr>
              <td>
                <div class="fw-semibold"><%= user.email.split("@").first.titleize %></div>
                <div class="text-muted"><%= user.email %></div>
              </td>
              <td>
                <span class="badge rounded-pill text-bg-<%= user.admin_role? ? "danger" : "secondary" %>">
                  <%= user.role %>
                </span>
              </td>
              <td><%= l user.created_at, format: :long %></td>
            </tr>
          <% end %>
          <% if @recent_users.empty? %>
            <tr>
              <td colspan="3" class="text-center text-muted py-4">まだユーザーが登録されていません。</td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
