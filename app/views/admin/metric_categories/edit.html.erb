<% content_for :title, "指標カテゴリ編集" %>
<% content_for :section_label, "マスタ管理" %>

<div class="row g-4">
  <div class="col-lg-5">
    <div class="card card-lift">
      <div class="card-body">
        <h2 class="h5 mb-3">カテゴリ設定</h2>
        <%= form_with model: [:admin, @category], local: true do |f| %>
          <div class="mb-3">
            <%= f.label :name, "カテゴリ名", class: "form-label" %>
            <%= f.text_field :name, class: "form-control" %>
          </div>
          <div class="mb-3">
            <%= f.label :display_label, "表示ラベル", class: "form-label" %>
            <%= f.text_field :display_label, class: "form-control" %>
          </div>
          <div class="mb-3">
            <%= f.label :position, "表示順", class: "form-label" %>
            <%= f.number_field :position, class: "form-control" %>
          </div>
          <%= f.submit "更新", class: "btn btn-primary" %>
          <%= link_to "一覧へ", admin_metric_categories_path, class: "btn btn-link" %>
        <% end %>
      </div>
    </div>
  </div>

  <div class="col-lg-7">
    <div class="card card-lift">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 class="h5 mb-0">項目一覧</h2>
          <%= link_to "項目追加", new_admin_metric_category_metric_category_item_path(@category), class: "btn btn-outline-primary btn-sm" %>
        </div>
        <table class="table table-sm align-middle">
          <thead>
            <tr>
              <th>表示ラベル</th>
              <th>ソース項目</th>
              <th>順番</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <% @category.items.ordered.each do |item| %>
              <tr>
                <td><%= item.display_label %></td>
                <td class="text-muted small"><%= simple_format(item.source_label_list.join("\n")) %></td>
                <td><%= item.position %></td>
                <td class="text-end">
                  <%= link_to "編集", edit_admin_metric_category_metric_category_item_path(@category, item), class: "btn btn-outline-primary btn-sm" %>
                  <%= link_to "削除", admin_metric_category_metric_category_item_path(@category, item), method: :delete,
                              data: { confirm: "削除しますか？" }, class: "btn btn-outline-danger btn-sm" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
